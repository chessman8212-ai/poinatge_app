{% extends "base.html" %}
{% block content %}
<h3>Formulaire de pointage</h3>

<form method="POST">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <label>Date</label>
  <input type="date" name="jour" value="{{ today.isoformat() }}" required>

  <label>Nom et prénom</label>
  <input type="text" name="nom" required placeholder="Nom et prénom">

  <label>Nature / Service</label>
  <select name="service">
    <option value="">-- Sélectionner --</option>
    {% for nat in natures %}
      <option value="{{ nat }}">{{ nat }}</option>
    {% endfor %}
  </select>

  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div>
      <label>Arrivée (24h)</label>
      <input type="time" name="arrivee" required step="60" placeholder="08:00">
    </div>
    <div>
      <label>Départ (24h)</label>
      <input type="time" name="depart" step="60" placeholder="17:00">
    </div>
  </div>

  <label>Note</label>
  <textarea name="note" rows="3" placeholder="Observation (optionnel)"></textarea>

  <div class="right">
    <button class="btn btn-primary" type="submit">Enregistrer</button>
  </div>
</form>

<h4 style="margin-top:18px;">Pointages du {{ today.strftime('%d/%m/%Y') }}</h4>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Nom</th>
      <th>Nature</th>
      <th>Arrivée</th>
      <th>Départ</th>
      <th>Note</th>
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td>{{ r.id }}</td>
      <td>{{ r.nom }}</td>
      <td>{{ r.service or "" }}</td>
      <td>{{ r.arrivee.strftime('%H:%M') if r.arrivee else "" }}</td>
      <td>{{ r.depart.strftime('%H:%M') if r.depart else "" }}</td>
      <td>{{ r.note or "" }}</td>
    </tr>
    {% endfor %}
    {% if rows|length == 0 %}
    <tr><td colspan="6" class="muted">Aucun pointage pour ce jour.</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
